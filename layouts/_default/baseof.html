<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>{{ .Site.Title }} | {{ .Title }}</title>
  <meta name="description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{else}}{{ .Description }}{{ end }}">

  {{ $preview_image := .Resources.GetMatch "site_preview" }}
  {{if $preview_image }}
    <meta property="og:image" content="{{ $preview_image.Permalink }}" />
    <meta property="og:title" content="{{ $preview_image.Title }}" />  
  {{ else }}
    <meta property="og:image" content="{{ .Site.Params.profileImage | absURL }}" />
    <meta property="og:title" content="{{ .Site.Title }} | {{ .Title }}" />   
  {{ end }}
  <meta property="og:description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{else}}{{ .Description }}{{ end }}" />
  <meta name="author" content="{{ .Site.Params.firstName }} {{ .Site.Params.lastName }}">

  <!-- Fade-in CSS -->
  <style>
    html { opacity: 0; }
    html.ready { opacity: 1; transition: opacity .2s ease; }
  </style>
  <noscript><style>html { opacity: 1 !important }</style></noscript>
  
  <!-- Add CSS smooth scrolling (replaces polyfills sourced from unpkg.com)  -->
  <style>html{scroll-behavior:smooth}</style>

  <!-- Hugo Pipes: custom styles, local fonts & Bootstrap -->
  {{- $bundle := slice
      (resources.Get "css/vendor/bootstrap-4.5.3.min.css")
      (resources.Get "css/resume.css")
      (resources.Get "css/tweaks.css")
      (resources.Get "css/resume-override.css")
      (resources.Get "css/fonts.css")
    | resources.Concat "css/app.css"
    | minify
    | fingerprint
  -}}

  <link rel="preload" href="{{ $bundle.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ $bundle.Permalink }}" integrity="{{ $bundle.Data.Integrity }}"></noscript>

  {{ hugo.Generator }}
  {{ partial "favicon.html" . }}
  {{ block "headfiles" . }}
  {{ end }}
</head>

<body id="page-top">
  {{ partial "nav.html" . }}
  <div class="container-fluid p-0">
    {{ block "main" . }}
      {{ .Content }}
    {{ end }}
  </div>

  <!-- Bootstrap core JavaScript (deferred, keeps order: jQuery -> Bootstrap -> site scripts) -->
  <script defer src="{{ "js/vendor/jquery-3.6.4.slim.min.js" | absURL }}"></script>
  <script defer src="{{ "js/vendor/bootstrap.bundle-4.5.3.min.js" | absURL }}"></script>

  <!-- Site scripts (deferred) -->
  <script defer src="{{ "js/site/navbar-collapse.js" | absURL }}"></script>
  <script defer src="{{ "js/site/scrollspy-init.js" | absURL }}"></script>
  <!-- <script defer src="{{ "js/site/tooltips-init.js" | absURL }}"></script> -->

  <!-- Custom scripts for this template -->
  <!-- <script async src="/js/resume.js"></script> -->
  {{ if .Site.Params.google.analytics.trackerID }}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.google.analytics.trackerID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ .Site.Params.google.analytics.trackerID }}');
    </script>
  {{ end }}

  {{ block "footerfiles" . }}

  {{ end }}
  {{ partial "footer.html" . }}
  
  <!-- === Badge Lightbox (HTML) === -->
  <div id="badge-lightbox" class="ilx-lightbox" aria-hidden="true" role="dialog" aria-label="Badge preview">
    <div class="ilx-lightbox__dialog">
      <button class="ilx-lightbox__close" aria-label="Close badge (Esc)">&times;</button>
      <img id="badge-image" alt="Course badge">
    </div>
  </div>

  <!-- === Badge Lightbox (JS) === -->
  <script>
  (function () {
    var lb   = document.getElementById('badge-lightbox');
    var img  = document.getElementById('badge-image');
    var btn  = lb.querySelector('.ilx-lightbox__close');
    var last = null;

    function openLB(src, trigger) {
      last = trigger || null;
      var pre = new Image();
      pre.onload = function () {
        img.src = src;
        lb.classList.add('is-active');
        lb.setAttribute('aria-hidden', 'false');
        requestAnimationFrame(function () { lb.classList.add('is-open'); btn.focus({preventScroll:true}); });
      };
      pre.src = src;
    }
    function closeLB() {
      lb.classList.remove('is-open');
      lb.setAttribute('aria-hidden', 'true');
      setTimeout(function(){ lb.classList.remove('is-active'); img.removeAttribute('src'); if (last) try{last.focus()}catch(e){}; }, 180);
    }

    document.addEventListener('click', function (e) {
      var a = e.target.closest('a.badge-link');
      if (a) {
        e.preventDefault();
        openLB(a.dataset.badge || a.getAttribute('href'), a);
      }
      if (e.target === lb) closeLB();
    });

    btn.addEventListener('click', closeLB);
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && lb.classList.contains('is-active')) closeLB();
    });
  })();
  </script>

  <!-- Fade-in after fonts load (with timeout safety) -->
  <script>
  (function () {
    var shown = false;
    function show() {
      if (!shown) {
        shown = true;
        document.documentElement.classList.add('ready');
      }
    }

    // Safety: never wait forever for fonts
    var fallback = setTimeout(show, 1500); // reveal after 1.5s if fonts are slow

    function go() {
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(function () {
          clearTimeout(fallback);
          show();
        }).catch(show);
      } else {
        show();
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', go, { once: true });
    } else {
      go();
    }

    // Ultimate safety if everything else finishes
    window.addEventListener('load', show, { once: true });
  })();
  </script>
</body>

</html>
