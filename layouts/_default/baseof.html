<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>{{ .Site.Title }} | {{ .Title }}</title>
  <meta name="description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{else}}{{ .Description }}{{ end }}">

  {{ $preview_image := .Resources.GetMatch "site_preview" }}
  {{if $preview_image }}
    <meta property="og:image" content="{{ $preview_image.Permalink }}" />
    <meta property="og:title" content="{{ $preview_image.Title }}" />  
  {{ else }}
    <meta property="og:image" content="{{ .Site.Params.profileImage | absURL }}" />
    <meta property="og:title" content="{{ .Site.Title }} | {{ .Title }}" />   
  {{ end }}
  <meta property="og:description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{else}}{{ .Description }}{{ end }}" />
  <meta name="author" content="{{ .Site.Params.firstName }} {{ .Site.Params.lastName }}">

  <!-- Google Fonts: load without fallback flash -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&family=Saira+Extra+Condensed:wght@100;200;300;400;500;600;700;800;900&display=block" rel="stylesheet">

  <!-- Fade-in CSS -->
  <style>
    html { opacity: 0; }
    html.ready { opacity: 1; transition: opacity .2s ease; }
  </style>
  <noscript><style>html { opacity: 1 !important }</style></noscript>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link rel="preload" href="{{ "css/resume.css" | absURL }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ "css/resume.css" | absURL }}"></noscript>
  <link rel="preload" href="{{ "css/tweaks.css" | absURL }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ "css/tweaks.css" | absURL }}"></noscript>
  <link rel="preload" href="{{ "css/resume-override.css" | absURL }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ "css/resume-override.css" | absURL }}"></noscript>
  {{ hugo.Generator }}
  {{ partial "favicon.html" . }}
  {{ block "headfiles" . }}
  {{ end }}
</head>

<body id="page-top">
  {{ partial "nav.html" . }}
  <div class="container-fluid p-0">
    {{ block "main" . }}
      {{ .Content }}
    {{ end }}
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="https://code.jquery.com/jquery-3.6.4.slim.min.js" integrity="sha256-a2yjHM4jnF9f54xUQakjZGaqYs/V1CYvWpoqZzC2/Bw=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  
  <!-- Auto-collapse mobile navbar menu after clicking a link (requires jQuery + Bootstrap collapse) -->
  <script>
    $(function () {
      $('.navbar-collapse .nav-link').on('click', function () {
        $('.navbar-collapse').collapse('hide');
      });
    });
  </script>

  <!-- Activate Bootstrap 4 Scrollspy -->
  <script>
    $(function () {
      $('body').scrollspy({
        target: '#sideNav',
        offset: 80
      });
    });
  </script>

  <!-- Polyfill for Smooth Scrolling -->
  <script src="https://unpkg.com/smoothscroll-polyfill@0.4.4/dist/smoothscroll.min.js" integrity="sha384-EYn4rWu1DHvYD0sSSSbMEtXQmMl58CFJd897806+RT1jJVYbhuZlZMN6yG9nCyFa" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/smoothscroll-anchor-polyfill@1.3.2/dist/index.min.js" integrity="sha384-EY9NBEHCFbZANmPcTm7CgG8OhsFILy0VBLG85pF6OIpP42NVbZVNsFOc23PYTCkB" crossorigin="anonymous"></script>
  
  <!-- Custom scripts for this template -->
  <!-- <script async src="/js/resume.js"></script> -->
  {{ if .Site.Params.google.analytics.trackerID }}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.google.analytics.trackerID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ .Site.Params.google.analytics.trackerID }}');
    </script>
  {{ end }}

  {{ block "footerfiles" . }}

  {{ end }}
  {{ partial "footer.html" . }}
  
  <!-- === Badge Lightbox (HTML) === -->
  <div id="badge-lightbox" class="ilx-lightbox" aria-hidden="true" role="dialog" aria-label="Badge preview">
    <div class="ilx-lightbox__dialog">
      <button class="ilx-lightbox__close" aria-label="Close badge (Esc)">&times;</button>
      <img id="badge-image" alt="Course badge">
    </div>
  </div>

  <!-- === Badge Lightbox (JS) === -->
  <script>
  (function () {
    var lb   = document.getElementById('badge-lightbox');
    var img  = document.getElementById('badge-image');
    var btn  = lb.querySelector('.ilx-lightbox__close');
    var last = null;

    function openLB(src, trigger) {
      last = trigger || null;
      var pre = new Image();
      pre.onload = function () {
        img.src = src;
        lb.classList.add('is-active');
        lb.setAttribute('aria-hidden', 'false');
        requestAnimationFrame(function () { lb.classList.add('is-open'); btn.focus({preventScroll:true}); });
      };
      pre.src = src;
    }
    function closeLB() {
      lb.classList.remove('is-open');
      lb.setAttribute('aria-hidden', 'true');
      setTimeout(function(){ lb.classList.remove('is-active'); img.removeAttribute('src'); if (last) try{last.focus()}catch(e){}; }, 180);
    }

    document.addEventListener('click', function (e) {
      var a = e.target.closest('a.badge-link');
      if (a) {
        e.preventDefault();
        openLB(a.dataset.badge || a.getAttribute('href'), a);
      }
      if (e.target === lb) closeLB();
    });

    btn.addEventListener('click', closeLB);
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && lb.classList.contains('is-active')) closeLB();
    });
  })();
  </script>

  <!-- Fade-in after fonts load (with timeout safety) -->
  <script>
  (function () {
    var shown = false;
    function show() {
      if (!shown) {
        shown = true;
        document.documentElement.classList.add('ready');
      }
    }

    // Safety: never wait forever for fonts
    var fallback = setTimeout(show, 1500); // reveal after 1.5s if fonts are slow

    function go() {
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(function () {
          clearTimeout(fallback);
          show();
        }).catch(show);
      } else {
        show();
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', go, { once: true });
    } else {
      go();
    }

    // Ultimate safety if everything else finishes
    window.addEventListener('load', show, { once: true });
  })();
  </script>
</body>

</html>
